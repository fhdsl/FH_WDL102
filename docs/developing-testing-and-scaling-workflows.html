<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Developing, Testing and Scaling Workflows | Cromwell Workflow Manager and WDL Workflows</title>
  <meta name="description" content="A getting started guide to creating and testing WDL workflows" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Developing, Testing and Scaling Workflows | Cromwell Workflow Manager and WDL Workflows" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A getting started guide to creating and testing WDL workflows" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Developing, Testing and Scaling Workflows | Cromwell Workflow Manager and WDL Workflows" />
  
  <meta name="twitter:description" content="A getting started guide to creating and testing WDL workflows" />
  



<meta name="date" content="2022-12-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="designing-wdls.html"/>
<link rel="next" href="about-the-authors.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>




<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<a href="https://hutchdatascience.org/" target="_blank"><img src="assets/big-dasl-stacked.png" style="width: 80%; padding-left: 15px; padding-top: 8px;"</a>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this Guide</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-wdl"><i class="fa fa-check"></i><b>1.1</b> What is WDL?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#openwdl"><i class="fa fa-check"></i><b>1.1.1</b> OpenWDL</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#documentation-about-the-wdl-spec"><i class="fa fa-check"></i><b>1.1.2</b> Documentation about the WDL Spec</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#tools-to-edit-wdl"><i class="fa fa-check"></i><b>1.1.3</b> Tools to Edit WDL</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-a-wdl-engine"><i class="fa fa-check"></i><b>1.2</b> What Is a WDL Engine?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-use-wdl-for-my-research"><i class="fa fa-check"></i><b>1.3</b> Why use WDL for my research?</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#abstracting-storage-and-computing-details"><i class="fa fa-check"></i><b>1.3.1</b> Abstracting Storage and Computing Details</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#reproducibility-and-portability"><i class="fa fa-check"></i><b>1.3.2</b> Reproducibility and Portability</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#software-and-environments"><i class="fa fa-check"></i><b>1.3.3</b> Software and Environments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="designing-wdls.html"><a href="designing-wdls.html"><i class="fa fa-check"></i><b>2</b> Designing WDLs</a>
<ul>
<li class="chapter" data-level="2.1" data-path="designing-wdls.html"><a href="designing-wdls.html#writing-workflows"><i class="fa fa-check"></i><b>2.1</b> Writing Workflows</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="designing-wdls.html"><a href="designing-wdls.html#design-recommendations"><i class="fa fa-check"></i><b>2.1.1</b> Design Recommendations</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="designing-wdls.html"><a href="designing-wdls.html#customizing-workflow-runs"><i class="fa fa-check"></i><b>2.2</b> Customizing Workflow Runs</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="designing-wdls.html"><a href="designing-wdls.html#workflow-options"><i class="fa fa-check"></i><b>2.2.1</b> Workflow Options</a></li>
<li class="chapter" data-level="2.2.2" data-path="designing-wdls.html"><a href="designing-wdls.html#runtime-defaults"><i class="fa fa-check"></i><b>2.2.2</b> Runtime Defaults</a></li>
<li class="chapter" data-level="2.2.3" data-path="designing-wdls.html"><a href="designing-wdls.html#call-caching"><i class="fa fa-check"></i><b>2.2.3</b> Call Caching</a></li>
<li class="chapter" data-level="2.2.4" data-path="designing-wdls.html"><a href="designing-wdls.html#workflow-failure-mode"><i class="fa fa-check"></i><b>2.2.4</b> Workflow Failure Mode</a></li>
<li class="chapter" data-level="2.2.5" data-path="designing-wdls.html"><a href="designing-wdls.html#copying-outputs"><i class="fa fa-check"></i><b>2.2.5</b> Copying outputs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html"><i class="fa fa-check"></i><b>3</b> Developing, Testing and Scaling Workflows</a>
<ul>
<li class="chapter" data-level="3.1" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#creating-an-inputs-template"><i class="fa fa-check"></i><b>3.1</b> Creating an Inputs template</a></li>
<li class="chapter" data-level="3.2" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#approaches-to-testing-and-development"><i class="fa fa-check"></i><b>3.2</b> Approaches to Testing and Development</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#start-from-a-template"><i class="fa fa-check"></i><b>3.2.1</b> Start from a template</a></li>
<li class="chapter" data-level="3.2.2" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#chose-software-modules"><i class="fa fa-check"></i><b>3.2.2</b> Chose Software Modules</a></li>
<li class="chapter" data-level="3.2.3" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#add-tasks"><i class="fa fa-check"></i><b>3.2.3</b> Add Tasks</a></li>
<li class="chapter" data-level="3.2.4" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#scale-up-inputs"><i class="fa fa-check"></i><b>3.2.4</b> Scale Up Inputs</a></li>
<li class="chapter" data-level="3.2.5" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#prep-for-other-platforms-and-sharing"><i class="fa fa-check"></i><b>3.2.5</b> Prep for Other Platforms and Sharing</a></li>
<li class="chapter" data-level="3.2.6" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#testing-input-availability"><i class="fa fa-check"></i><b>3.2.6</b> Testing Input Availability</a></li>
<li class="chapter" data-level="3.2.7" data-path="developing-testing-and-scaling-workflows.html"><a href="developing-testing-and-scaling-workflows.html#scaling-up-moving-to-the-cloud"><i class="fa fa-check"></i><b>3.2.7</b> Scaling Up, Moving to the Cloud</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="4" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>4</b> References</a></li>
<li class="divider"></li>
<p style="text-align:center;"> <a href="https://github.com/jhudsl/OTTR_Template" target="blank" > This content was published with</a> <a href="https://bookdown.org/" target="blank"> bookdown by: </a> </p>
<p style="text-align:center;"> <a href="http://hutchdatascience.org/"> The Fred Hutch Data Science Lab </a></p>
<p style="text-align:center; font-size: 12px;"> <a href="https://github.com/rstudio4edu/rstudio4edu-book/"> Style adapted from: rstudio4edu-book </a> <a href ="https://creativecommons.org/licenses/by/2.0/"> (CC-BY 2.0) </a></p>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cromwell Workflow Manager and WDL Workflows</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<head>
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=10.0,initial-scale=1.0">
  <!--script src="https://kit.fontawesome.com/6a26f47516.js"></script-->
  <!--<script src="assets/hideOutput.js"></script>-->
  <link href="assets/style.css" rel="stylesheet">
</head>
        


<div class="hero-image-container"> 
  <img class= "hero-image" src="assets/dasl_thin_main_image.png">
</div>
<div id="developing-testing-and-scaling-workflows" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Developing, Testing and Scaling Workflows</h1>
<div id="creating-an-inputs-template" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Creating an Inputs template</h2>
<p>There is a tool that is installed along with Cromwell called “womtool”. This tool is what does workflow validation through the Shiny app and fh.wdlR package. However, it has additional features that are not available unless you run it directly.</p>
<p>There is <a href="https://cromwell.readthedocs.io/en/stable/WOMtool/">specific documentation from the Broad about womtool</a> that can give you more information about the parameters and features of this small tool.</p>
<p>The most useful aspect to womtool is the ability to give it a new workflow you have written and have it give you a template input.json file for you to customize for use. To use it, log into Rhino and do the following:</p>
<pre><code>module load cromwell/84
java -jar $EBROOTCROMWELL/womtool.jar inputs myNewWorkflow.wdl &gt; input_template.json</code></pre>
<p>Now your template input information will be saved in the file <code>input_template.json1</code>.</p>
</div>
<div id="approaches-to-testing-and-development" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Approaches to Testing and Development</h2>
<div id="start-from-a-template" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Start from a template</h3>
<p>Preferably one that executes cleanly - even if it’s Hello World.</p>
</div>
<div id="chose-software-modules" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Chose Software Modules</h3>
<p>Test interactively with software modules on the cluster to see what inputs are required, what parameters you want to specify, what outputs get created.</p>
</div>
<div id="add-tasks" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Add Tasks</h3>
<p>Define tasks, using modules, test data (truncated files, scatters of 1), run and test.</p>
</div>
<div id="scale-up-inputs" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Scale Up Inputs</h3>
<p>Start to run workflow on full size data (scatters of 1), then start to scatter over several files, then scatter over entire datasets.</p>
</div>
<div id="prep-for-other-platforms-and-sharing" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Prep for Other Platforms and Sharing</h3>
<p>Shift to docker containers instead of modules, ensure that all inputs are specified as files not directories!!, start to optimize compute resources required for tasks (how much memory does it really need, or is it going to need many CPU’s).
- start small - start with truncated/downsampled data in the same formats but smaller!
- add tasks one at a time and leverage call caching to test single additions quickly
- start testing scatters with a scatter of one!</p>
</div>
<div id="testing-input-availability" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Testing Input Availability</h3>
<p>Validating a workflow only checks the formatting of the files but does not attempt to stage the inputs. To do that you might consider tricking Cromwell into localizing all external inputs first by creating a dummy task that runs first before any of your steps in your workflow.</p>
<p>The inputs to this task need to be all externally obtained file inputs to any task in your workflow (not inputs to tasks that come from other WDL tasks!). Then, upon running this workflow, Cromwell will try to localize all the inputs for this first task, before running any future tasks.</p>
<p>Then you have two options:
- my inputs are small or local: just remove the input localizing task before re-running the workflow
- my inputs are large or expensive to localize: specify the inputs to your workflow tasks as the outputs of this input localizing task by adding them as outputs.</p>
</div>
<div id="scaling-up-moving-to-the-cloud" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Scaling Up, Moving to the Cloud</h3>
<ul>
<li>Test with a scatter of many small files (not full size!)</li>
<li>Begin optimizing computing resources for each task</li>
<li>Dockerize single task environments</li>
<li>Test locally on small data scatters of 1 to shift from modules to Dockerize</li>
<li>Catch errors and adjust such as tools that rely on filesystems/directory structures which will break in the cloud</li>
<li>Learn about the cloud you’ll be using
<ul>
<li>what instance types exist and which are the best for you tasks/data</li>
<li>how do the data need to be stored in an object store?</li>
<li>how can you get permissions set up to access both the data and the compute resources?</li>
</ul></li>
</ul>

</div>
</div>
</div>
<hr>
<center> 
  <div class="footer">
      All illustrations <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY. </a>
      <br>
      All other materials <a href= "https://creativecommons.org/licenses/by/4.0/"> CC-BY </a> unless noted otherwise.
  </div>
</center>
            </section>

          </div>
        </div>
      </div>
<a href="designing-wdls.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="about-the-authors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
